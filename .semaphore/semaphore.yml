version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Tests
    task:
      jobs:
        - name: Static tests
          commands:
            - echo "running static tests"
            - npx prettier --check "src/**/*.ts" "tests/**/*.ts"
            - npx eslint --format junit "src/**/*.ts" "tests/**/*.ts" > eslint.xml
      prologue:
        commands:
          - checkout
          - npm ci
      env_vars: []
      epilogue:
        always:
          commands:
            - '[[ -f eslint.xml ]] && test-results publish eslint.xml'
  - name: Unit Test
    task:
      secrets:
        - name: RIOT_API_KEY
      prologue:
        commands:
          - checkout
          - npm ci
      epilogue:
        always:
          commands:
            - '[[ -f junit.xml ]] && test-results publish junit.xml'
      jobs:
        - name: Testing
          commands:
            - echo "running unit tests"
            - npm run build
            - npx jest --ci --runInBand --reporters=default --reporters=jest-junit
after_pipeline:
  task:
    jobs:
      - name: Publish reports
        commands:
          - test-results gen-pipeline-report
